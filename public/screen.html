<!DOCTYPE html>
<html>
    <head>
        <title>SinkIt - Screen</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script type="text/javascript" src="js/external/phaser.min.js"></script>
        <script type="text/javascript" src="js/external/airconsole-1.7.0.js"></script>
        <script type="text/javascript" src="js/common/messagedispatcher.js"></script>
        <script type="text/javascript" src="js/common/gamestate.js"></script>
        <script type="text/javascript" src="js/screen/game.js"></script>
        <script type="text/javascript" src="js/screen/screenmain.js"></script>
        <link rel="stylesheet" href="css/style.css" />
    </head>
    <body>

        <script type="text/javascript">
            // initialize dependencies
            var air_console = new AirConsole();
            var game_state = new GameState();
            var md = new MessageDispatcher(air_console);

            // link game state and messages received from clients
            md.register('startAction', game_state.startAction);
            md.register('stopAction', game_state.stopAction);

            /* legacy +-vib game */
            md.register('increment', game_state.increment);
            md.register('decrement', game_state.decrement);
            md.register('vibrate', function vibrateClients() {
                md.broadcast('vibrate');
            });

            // link game state changes and update of DOM
            game_state.on('update', function(state) {
                document.getElementById('gamestate').innerHTML = JSON.stringify(state);
            });

            air_console.onDeviceStateChange = function(device_id, user_data) {
                var ids = air_console.getControllerDeviceIds();
                document.getElementById('deviceIds').innerHTML = JSON.stringify([ids, user_data]);
            };

        </script>

        <span id="deviceIds"></span><br />
        <pre id="gamestate"></pre>
    </body>
</html>

